class_name Character extends Node

var job: String
var max_hp: int
var hp: int
var image: Texture2D

var level: int
var experience: int

var attack: int
var defense: int
var speed: float

var dead: bool = false

var exp_table = [
	0, 28, 84, 196, 392, 700, 1148, 1764, 2576, 3612,
	4900, 6468, 8344, 10556, 13132, 16100, 19488, 23324, 27636, 32452,
	37800, 43708, 50204, 57316, 65072, 73500, 82628, 92484, 103096, 114492,
	126700, 139748, 153664, 168476, 184212, 200900, 218568, 237244, 256956, 277732,
	299600, 322588, 346724, 372036, 398552, 426300, 455300, 484299, 513299, 542298,
	571298, 600297, 629297, 658296, 687296, 716295, 745295, 774294, 803294, 832293,
	861293, 890292, 919292, 948291, 977291, 1006290, 1035290, 1064289, 1093289, 1122288,
	1151288, 1180287, 1209287, 1238286, 1267286, 1296285, 1325285, 1354284, 1383284, 1412283,
	1441283, 1470282, 1499282, 1528281, 1557281, 1586280, 1615280, 1644279, 1673279, 1702278,
	1731278, 1760277, 1789277, 1818276, 1847276, 1876275, 1905275, 1934274, 1963274, 1963274,
	1979401, 1995660, 2012053, 2028581, 2045244, 2062045, 2078983, 2096060, 2113278, 2130637,
	2148139, 2165784, 2183575, 2201511, 2219595, 2237828, 2256210, 2274743, 2293429, 2312268,
	2331261, 2350411, 2369718, 2389184, 2408809, 2428596, 2448545, 2468658, 2488937, 2509382,
	2529994, 2550777, 2571729, 2592854, 2614153, 2635626, 2657276, 2679104, 2701111, 2723299,
	2745669, 2768223, 2790962, 2813888, 2837002, 2860306, 2883801, 2907490, 2931373, 2955452,
	2979729, 3004205, 3028883, 3053763, 3078848, 3104138, 3129637, 3155344, 3181263, 3207395,
	3233742, 3260305, 3287086, 3314087, 3341310, 3368757, 3396429, 3424328, 3452457, 3480816,
	3509409, 3538236, 3567300, 3596603, 3626147, 3655933, 3685964, 3716242, 3746768, 3777545,
	3808575, 3839860, 3871402, 3903203, 3935265, 3967591, 4000182, 4033040, 4066169, 4099570,
	4133245, 4167197, 4201427, 4235939, 4270735, 4305816, 4341185, 4376845, 4412798, 4449046,
	4485592, 4522438, 4559587, 4597040, 4634802, 4672874, 4711258, 4749958, 4788976, 4828314,
	4867975, 4907962, 4948278, 4988924, 5029905, 5071222, 5112879, 5154878, 5197221, 5239913,
	5282955, 5326351, 5370104, 5414215, 5458689, 5503529, 5548736, 5594316, 5640269, 5686600,
	5733312, 5780407, 5827889, 5875761, 5924026, 5972688, 6021750, 6071214, 6121085, 6171366,
	6222059, 6273169, 6324699, 6376652, 6429032, 6481842, 6535086, 6588767, 6642889, 6697456,
	6752471, 6807938, 6863861, 6920242, 6977088, 7034400, 7092182, 7150440, 7209176, 7268394,
	7328099, 7388294, 7448984, 7510172, 7571863, 7634061, 7696770, 7759993, 7823736, 7888003,
	7952798, 8018124, 8083988, 8150392, 8217342, 8284842, 8352896, 8421510, 8490686, 8560432,
	8630750, 8701645, 8773124, 8845189, 8917846, 8991100, 9064956, 9139418, 9214492, 9290183,
	9366495, 9443435, 9521006, 9599215, 9678066, 9757564, 9837716, 9918526, 10000000
]

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(_delta: float) -> void:
	pass

func get_exp_for_level(l: int) -> int:
	if l < 1 or l > exp_table.size():
		return 999999999 # cap at max level
	return exp_table[l - 1]

func add_experience(amount: int) -> void:
	experience += amount
	_check_level_up()

func _check_level_up() -> void:
	while level < exp_table.size() and experience >= get_exp_for_level(level + 1):
		level += 1
		_level_up()
		BattleManager.battle_scene.refresh_stats()

func _level_up() -> void:
	var hp_increase: int = randi_range(3, 8)
	max_hp += hp_increase
	hp += hp_increase
	if job == "warrior":
		attack += 1
		defense += 1
